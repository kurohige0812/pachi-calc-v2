<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>貯玉・現金・1250計算機</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .section { margin-bottom: 40px; border: 1px solid #ccc; padding: 20px; border-radius: 10px; }
    input[type="number"], input[type="text"] { width: 100px; margin: 5px; }
    button { margin: 5px; }
    .result { margin-top: 10px; white-space: pre-wrap; background: #f9f9f9; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

  <div class="section" id="tama-section">
    <h2>1. 貯玉計算機</h2>
    初期貯玉：<input type="number" id="tama-initial"> 現在の貯玉：<input type="number" id="tama-current">
    <button onclick="calcTama()">決定</button>
    <button onclick="resetTama()">リセット</button>
    <div class="result" id="tama-result"></div>
  </div>

 <div class="section" id="cash-section">
  <h2>2. 現金計算機</h2>
  <label>枚目：</label>
  <select id="bill-number">
    {% for i in range(1, 31) %}
      <option value="{{ i }}">{{ i }}枚目</option>
    {% endfor %}
  </select>
  <label>数字：</label>
  <input type="number" id="cash-value" min="0" max="100" value="100">
  <button onclick="addCashEntry()">決定</button>
  <button onclick="endCash()">稼働終了</button>
  <button onclick="resetCash()">リセット</button>
  <div class="result" id="cash-log"></div>
</div>



  <div class="section" id="calc1250-section">
    <h2>3. 新1250計算機</h2>
    着席回転数：<input type="number" id="base-spin"> <button onclick="resetSpin()">リセット</button><br>
    現在回転数：<input type="number" id="now-spin">
    <button onclick="calcSpin()">計算</button>
    <br><br>
    持ち玉：<input type="number" id="moti">
    貯玉：<input type="number" id="tama">
    現金：<input type="number" id="cash">
    <button onclick="calc1250()">決定</button>
    <button onclick="reset1250()">リセット</button>
    <div class="result" id="result1250"></div>
  </div>

<script>
// 1. 貯玉
function calcTama() {
  let ini = parseInt($('#tama-initial').val());
  let now = parseInt($('#tama-current').val());
  if (isNaN(ini) || isNaN(now)) return;
  let used = ini - now;
  $('#tama-result').text(`使用貯玉 ${used} 玉`).css('cursor', 'pointer').click(() => navigator.clipboard.writeText(`${used}`));
}
function resetTama() {
  $('#tama-initial, #tama-current, #tama-result').val('').text('');
}

// 2. 現金
let cashEntries = [];
let cashTotal = 0;

function addCashEntry() {
  const bill = parseInt(document.getElementById("bill-number").value);
  const val = parseInt(document.getElementById("cash-value").value);

  if (isNaN(bill) || isNaN(val)) return;

  let used = (bill - 1) * 10000 + (100 - val) * 100;
  cashEntries.push({ bill, val, used });
  updateCashLog();
}

function updateCashLog() {
  let log = "";
  cashTotal = 0;
  for (let i = 0; i < cashEntries.length; i++) {
    const e = cashEntries[i];
    log += `${e.bill}枚目 (${e.val}) → 使用金額：${e.used.toLocaleString()}円\n`;
    cashTotal += e.used;
  }
  document.getElementById("cash-log").textContent = log;
}

function endCash() {
  let result = "";
  for (let i = 0; i < cashEntries.length; i++) {
    result += `${i + 1}台目使用金額：${cashEntries[i].used.toLocaleString()}円\n`;
  }
  result += `稼働使用合計金額：${cashTotal.toLocaleString()}円`;
  document.getElementById("cash-log").textContent = result;
  navigator.clipboard.writeText(result);
}

function resetCash() {
  cashEntries = [];
  cashTotal = 0;
  document.getElementById("cash-log").textContent = "";
}


// 3. 着席回転数
function resetSpin() {
  $('#base-spin').val('');
}
function calcSpin() {
  let base = parseInt($('#base-spin').val()) || 0;
  let now = parseInt($('#now-spin').val());
  if (isNaN(now)) return;
  let diff = now - base;
  $('#result1250').append(`\n回転数：${diff}回\n`).css('cursor', 'pointer');
}
function calc1250() {
  let moti = parseInt($('#moti').val()) || 0;
  let tama = parseInt($('#tama').val()) || 0;
  let cash = parseInt($('#cash').val()) || 0;
  let left = 1250;
  let log = '';

  if (moti >= left) {
    log += `持ち玉 ${left} 使用\n`;
  } else {
    if (moti > 0) {
      log += `持ち玉 ${moti} 使用\n`;
      left -= moti;
    }
    if (tama >= left) {
      log += `貯玉 ${left} 使用\n`;
      left = 0;
    } else {
      if (tama > 0) {
        log += `貯玉 ${tama} 使用\n`;
        left -= tama;
      }
      if (left > 0) {
        log += `現金 ${left} 使用\n`;
      }
    }
  }
  $('#result1250').append(log + '\n').css('cursor', 'pointer');
}
function reset1250() {
  $('#moti, #tama, #cash, #result1250').val('').text('');
}
</script>
</body>
</html>
